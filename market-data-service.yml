management:
  health:
    kafka:
      enabled: false
    redis:
      enabled: false
  endpoint:
    health:
      show-details: always
  endpoints:
    web:
      exposure:
        include: health,info,prometheus

# AlphaVantage
alphavantage:
  api-key: ${ALPHAVANTAGE_API_KEY:demo}
  rate-limit-per-minute: ${ALPHAVANTAGE_RATE_LIMIT:75}
  timeout-seconds: 15
  base-url: "https://www.alphavantage.co/query"
  retry:
    max-attempts: 3
    backoff-delay: 1000
  scheduler:
    zone: ${ALPHAVANTAGE_SCHEDULER_ZONE:Asia/Seoul}
    fx:
      cron: ${ALPHAVANTAGE_SCHEDULER_FX_CRON:0 10 11 * * MON-FRI}
    candle:
      cron: ${ALPHAVANTAGE_SCHEDULER_CANDLE_CRON:0 0 7 * * MON-FRI}
    marketcap:
      cron: ${ALPHAVANTAGE_SCHEDULER_MARKETCAP_CRON:0 0 10 * * MON-FRI}

# Korea EXIM 환율 API
korea-exim:
  enabled: true
  api:
    auth-key: ${KOREAEXIM_API_KEY:demo}
  base-url: "https://www.koreaexim.go.kr/site/program/financial/exchangeJSON"

# Yahoo Finance
yahoo:
  finance:
    base-url: "https://query1.finance.yahoo.com"
    timeout-seconds: 10
    rate-limit-per-second: 10
    retry:
      max-attempts: 3
      backoff-delay: 500

keycloak:
  resource: muscat-user-cc

marketdata:

  provider: ${MARKETDATA_PROVIDER:alphavantage}

  symbol-collection:
    enabled: ${SYMBOL_COLLECTION_ENABLED:true}
    lookback-days: ${SYMBOL_LOOKBACK_DAYS:365}
    collect-data: ${SYMBOL_COLLECT_DATA:true}
    include-dividends: ${SYMBOL_INCLUDE_DIVIDENDS:true}

  symbol-listing:
    only-major-exchanges: ${SYMBOL_LISTING_ONLY_MAJOR:true}
    max-symbols: ${SYMBOL_LISTING_MAX:100}

  market-cap-collection:
    enabled: ${MARKET_CAP_COLLECTION_ENABLED:true}
    batch-size: ${MARKET_CAP_BATCH_SIZE:100}
    log-interval: ${MARKET_CAP_LOG_INTERVAL:10}

  constants:
    fx:
      default-base-rate: ${FX_DEFAULT_RATE:1350}
      scale: ${FX_SCALE:6}
      max-fallback-days: ${FX_FALLBACK_DAYS:7}
    batch:
      min-rpm: ${BATCH_MIN_RPM:1}
      max-backoff-ms: ${BATCH_MAX_BACKOFF:30000}
      millis-per-minute: 60000
    database:
      symbol-max-length: 16
      currency-length: 3
      decimal-precision: 19
      decimal-scale: 8
    calculation:
      percent-scale: 4
      percentage-multiplier: 100

    fx-ingest:
      backfill:
        enabled: ${FX_BACKFILL_ENABLED:false}
        lookback-days: ${FX_BACKFILL_LOOKBACK:365}
      incremental:
        enabled: ${FX_INCREMENTAL_ENABLED:true}
        default-days: ${FX_INCREMENTAL_DAYS:30}
      scheduler:
        enabled: ${FX_SCHEDULER_ENABLED:false}
        cron: ${FX_SCHEDULER_CRON:0 10 11 * * MON-FRI}
        zone: ${FX_SCHEDULER_ZONE:Asia/Seoul}

  feed:
    symbol:
      enabled: ${SYMBOL_COLLECTION_ENABLED:true}
      startup-delay: ${SYMBOL_STARTUP_DELAY:90}
    schedule:
      enabled: ${SCHEDULE_ENABLED:false}
      cron: ${SCHEDULE_CRON:0 0 5 * * *}
      timezone: ${SCHEDULE_TIMEZONE:America/New_York}
      lookback-days: ${SCHEDULE_LOOKBACK:365}

  cache:
    price-data-ttl: ${CACHE_PRICE_TTL:300}
    fx-rate-ttl: ${CACHE_FX_TTL:3600}
    symbol-info-ttl: ${CACHE_SYMBOL_TTL:86400}
    dividend-ttl: ${CACHE_DIVIDEND_TTL:86400}
